{% comment %}
  Customer Account Dashboard Template
  Designed to match the functionality of jockey.com.au/customer/account/
{% endcomment %}

{% layout theme %}

<div class="customer-dashboard">
  <div class="dashboard-header">
    <h1>My Account</h1>
    <p>Welcome, {{ customer.name }}!</p>
  </div>
  
  <div class="dashboard-content">
    <!-- Left Navigation -->
    <div class="dashboard-nav">
      <ul>
        <li class="active"><a href="#account-info">Account Information</a></li>
        <li><a href="#orders">My Orders</a></li>
        <li><a href="#addresses">Address Book</a></li>
        <li><a href="#wishlist">My Wishlist</a></li>
        <li><a href="#recently-viewed">Recently Viewed</a></li>
        <li><a href="{{ routes.account_logout_url }}">Log Out</a></li>
      </ul>
    </div>
    
    <!-- Right Content Area -->
    <div class="dashboard-main">
      <!-- Account Information Section -->
      <section id="account-info" class="dashboard-section active">
        <h2>Account Information</h2>
        <div class="account-details">
          <div class="detail-row">
            <span class="label">Name:</span>
            <span class="value">{{ customer.name }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Email:</span>
            <span class="value">{{ customer.email }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Phone:</span>
            <span class="value">
              {% if customer.phone != blank %}
                {{ customer.phone }}
              {% else %}
                Not provided
              {% endif %}
            </span>
          </div>
        </div>
      </section>
      
      <!-- Orders Section -->
      <section id="orders" class="dashboard-section">
        <h2>Order History</h2>
        {% if customer.orders.size == 0 %}
          <p>You haven't placed any orders yet.</p>
        {% else %}
          <div class="orders-table">
            <div class="table-header">
              <div>Order #</div>
              <div>Date</div>
              <div>Status</div>
              <div>Total</div>
              <div>Actions</div>
            </div>
            {% for order in customer.orders %}
              <div class="table-row">
                <div>{{ order.name | link_to: order.customer_url }}</div>
                <div>{{ order.created_at | date: "%b %d, %Y" }}</div>
                <div>{{ order.fulfillment_status_label }}</div>
                <div>{{ order.total_price | money }}</div>
                <div>
                  <a href="{{ order.customer_url }}" class="btn-view-order">View Order</a>
                  {% if order.fulfillment_status == 'fulfilled' %}
                    <a href="#" class="btn-track">Track</a>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </section>
      
      <!-- Addresses Section -->
      <section id="addresses" class="dashboard-section">
        <h2>Address Book</h2>
        <div class="addresses-container">
          <div class="default-address">
            <h3>Default Address</h3>
            {% if customer.default_address != nil %}
              {{ customer.default_address | format_address }}
            {% else %}
              <p>You haven't set a default address.</p>
            {% endif %}
            <button class="btn-edit-address" data-address-id="{{ customer.default_address.id }}">Edit</button>
          </div>
          
          {% if customer.addresses_count > 1 %}
            <div class="additional-addresses">
              <h3>Additional Addresses</h3>
              {% for address in customer.addresses %}
                {% if address != customer.default_address %}
                  <div class="address">
                    {{ address | format_address }}
                    <div class="address-actions">
                      <button class="btn-edit-address" data-address-id="{{ address.id }}">Edit</button>
                      <form method="post" action="/account/addresses/{{ address.id }}">
                        <input type="hidden" name="_method" value="delete">
                        <button type="submit" class="btn-delete-address">Delete</button>
                      </form>
                    </div>
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}
          
          <button id="btn-add-address" class="btn-primary">Add New Address</button>
        </div>
      </section>
      
      <!-- Wishlist Section -->
      <section id="wishlist" class="dashboard-section">
        <h2>My Wishlist</h2>
        {% if customer.wishlist.size == 0 %}
          <p>Your wishlist is empty.</p>
        {% else %}
          <div class="wishlist-grid">
            {% for item in customer.wishlist %}
              <div class="wishlist-item">
                <div class="product-image">
                  <img src="{{ item.image | img_url: 'medium' }}" alt="{{ item.title }}">
                </div>
                <div class="product-details">
                  <h3>{{ item.title }}</h3>
                  <p class="price">{{ item.price | money }}</p>
                </div>
                <div class="wishlist-actions">
                  <a href="{{ item.url }}" class="btn-view-product">View Product</a>
                  <form method="post" action="/wishlist/remove">
                    <input type="hidden" name="id" value="{{ item.variant_id }}">
                    <button type="submit" class="btn-remove">Remove</button>
                  </form>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </section>
      
      <!-- Recently Viewed Section -->
      <section id="recently-viewed" class="dashboard-section">
        <h2>Recently Viewed</h2>
        {% if customer.recently_viewed.size == 0 %}
          <p>You haven't viewed any products recently.</p>
        {% else %}
          <div class="recently-viewed-grid">
            {% for product in customer.recently_viewed %}
              <div class="product-card">
                <div class="product-image">
                  <img src="{{ product.featured_image | img_url: 'medium' }}" alt="{{ product.title }}">
                </div>
                <div class="product-info">
                  <h3>{{ product.title }}</h3>
                  <p class="price">{{ product.price | money }}</p>
                  <a href="{{ product.url }}" class="btn-view-product">View Product</a>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </section>
    </div>
  </div>
</div>

<style>
  .customer-dashboard {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }
  
  .dashboard-header {
    margin-bottom: 30px;
    border-bottom: 1px solid #e1e1e1;
    padding-bottom: 15px;
  }
  
  .dashboard-content {
    display: flex;
    gap: 30px;
  }
  
  .dashboard-nav {
    flex: 0 0 250px;
  }
  
  .dashboard-nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .dashboard-nav li {
    margin-bottom: 10px;
  }
  
  .dashboard-nav a {
    display: block;
    padding: 12px 15px;
    text-decoration: none;
    color: #333;
    border-left: 3px solid transparent;
  }
  
  .dashboard-nav li.active a {
    border-left-color: #000;
    font-weight: bold;
    background-color: #f9f9f9;
  }
  
  .dashboard-main {
    flex: 1;
  }
  
  .dashboard-section {
    display: none;
  }
  
  .dashboard-section.active {
    display: block;
  }
  
  .detail-row {
    display: flex;
    margin-bottom: 15px;
  }
  
  .detail-row .label {
    font-weight: bold;
    min-width: 100px;
  }
  
  .orders-table {
    border: 1px solid #e1e1e1;
    border-radius: 4px;
    overflow: hidden;
  }
  
  .table-header, .table-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr 1.5fr;
    padding: 15px;
  }
  
  .table-header {
    background-color: #f5f5f5;
    font-weight: bold;
  }
  
  .table-row {
    border-top: 1px solid #e1e1e1;
  }
  
  .addresses-container {
    margin-bottom: 20px;
  }
  
  .default-address, .address {
    border: 1px solid #e1e1e1;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 4px;
  }
  
  .address-actions {
    margin-top: 10px;
  }
  
  .wishlist-grid, .recently-viewed-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
  }
  
  .wishlist-item, .product-card {
    border: 1px solid #e1e1e1;
    padding: 15px;
    border-radius: 4px;
  }
  
  .product-image {
    text-align: center;
    margin-bottom: 15px;
  }
  
  .product-image img {
    max-width: 100%;
    height: auto;
  }
  
  .btn-primary, .btn-view-order, .btn-track, .btn-edit-address, 
  .btn-delete-address, .btn-view-product, .btn-remove {
    display: inline-block;
    padding: 8px 15px;
    border: 1px solid #000;
    background: #000;
    color: #fff;
    text-decoration: none;
    cursor: pointer;
    margin-right: 5px;
    margin-bottom: 5px;
  }
  
  .btn-delete-address, .btn-remove {
    background: #d32f2f;
    border-color: #d32f2f;
  }
  
  @media (max-width: 768px) {
    .dashboard-content {
      flex-direction: column;
    }
    
    .dashboard-nav {
      flex: 0 0 auto;
    }
    
    .table-header, .table-row {
      grid-template-columns: 1fr;
      gap: 5px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Tab navigation
    const navLinks = document.querySelectorAll('.dashboard-nav a');
    const sections = document.querySelectorAll('.dashboard-section');
    
    navLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Remove active class from all links and sections
        navLinks.forEach(navLink => navLink.parentElement.classList.remove('active'));
        sections.forEach(section => section.classList.remove('active'));
        
        // Add active class to current link and section
        this.parentElement.classList.add('active');
        const targetSection = document.querySelector(this.getAttribute('href'));
        targetSection.classList.add('active');
      });
    });
    
    // Address management
    const addAddressBtn = document.getElementById('btn-add-address');
    const editAddressBtns = document.querySelectorAll('.btn-edit-address');
    
    if (addAddressBtn) {
      addAddressBtn.addEventListener('click', function() {
        // Implementation for adding a new address
        console.log('Add new address clicked');
        // Shopify has built-in address forms that can be used
      });
    }
    
    editAddressBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        const addressId = this.getAttribute('data-address-id');
        // Implementation for editing an address
        console.log('Edit address:', addressId);
        // Shopify has built-in address forms that can be used
      });
    });
  });
</script>